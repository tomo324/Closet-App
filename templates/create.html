{% extends 'base.html' %}

{% block head %}
<meta charset="UTF-8">
<link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
{% endblock %}

{% block body %}

{% with messages = get_flashed_messages() %}
    {% if messages %}
        <ul class="create-flashes">
            {% for message in messages %}
                <li class="check-file">{{ message }}</li>
            {% endfor %}
        </ul>
    {% endif %}
{% endwith %}

<form id="crop-form" action="/create", method="POST" enctype="multipart/form-data">
    <div>
        <label for="title">Title</label>
        <input type="text" name="title">
    </div>
    <div>
        <label for="detail">Detail</label>
        <input type="text" name="detail">
        <!-- 元となるファイルの入力 -->
        <input type="file" id="file-input">
        <select name="category">
            <option value="tops">Tops</option>
            <option value="bottoms">Bottoms</option>
        </select><br>
    </div>
    <!-- トリミングする画像が表示される要素 -->
    <div id="cropped-container">
        <!-- クロップされた画像のbase64エンコードデータを保持する隠しフィールド -->
        <input type="hidden" id="crop-result" name="crop-result" value="">
    </div>
    <button id="apply-crop" type="submit">Save</button>
</form>
<a href="/index" rule="button">Return</a>

{% if cropped_image is not none %}
<p>-------------------------------------------------------------------------------</p>
<ul>
    <li>{{ title }}</li>
    <li>{{ detail }}</li>
    <li>{{ category }}</li>
    <img  id="original-cropped" src="data:image/jpeg;base64,{{ cropped_image }}" alt="cropped_image">
</ul>
<form id="submit-image-form" action="/save" method="POST">
    <input id="image-src-input" type="hidden" name="image-src-input", value="">
    <button type="submit">そのまま保存する</button>
</form>

<a href="/save" role="button">画像を透過して保存</a>

{% endif %}
<link href="{{ url_for('static', filename='css/cropper.min.css') }}" rel="stylesheet">
<script src="{{ url_for('static', filename='js/cropper.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/image_cropping.js') }}"></script>
{% endblock %}